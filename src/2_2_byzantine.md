> 모두가 X를 안다는 사실로는 충분하지 않습니다. 모두가 X를 안다는 사실도 모두가 알아야 하고요, 또 모두가 X를 안다는 사실을 우리 모두가 다 안다는 사실도 전원이 알아야 하지요. 이는 비잔틴 장군의 문제처럼, 분산 데이터 시스템에서 오래된 난제입니다.

# 비잔틴 장군의 문제

비잔티움 제국의 장군들이 적의 수중에 있는 도시를 포위하려 한다. 전투 준비를 마친 각 장군들은 제국군의 대부분이 한꺼번에 도시를 공성해야지만 이 도시를 함락시킬수 있음을 알고 있다.

그러나 비잔티움의 장군들은 자신들 중 몇몇이 이미 적과 내통하고 있음과 서로에게 연락할 전령들이 도시에서 나온 척후대에게 사로잡힐 수 있음을 이미 알고 있다.

어떤 장군이 황제에게 충성스러운지, 혹은 모반을 하려는지 확실하지 못한 상황에서 충성스러운 장군들은 배신자들이 병력을 물려 공성을 방해하거나 적에게 소식을 넘길수 있다는 상황 때문에 딜레마에 빠진다.

충직한 장군들은 전령들이 보낸 명령을 충실하게 따르며 이 외의 행동은 하지 않는다. 그러나 전체 장군 중 일부인 배신자 장군들은 전령에 얽매이지 않고 마음대로 행동할 수 있다. 이 때 배신자의 존재에도 불구하고 충직한 장군들이 동일한 공격 계획을 세우기 위해서는 충직한 장군들의 수가 얼마나 있어야 하며, 장군들이 어떤 규칙을 따라 교신해야 하는지에 대한 문제가 바로 비잔티움 장군 문제다.

예를 들어 여섯개의 부대가 한꺼번에 금요일 오후 1시에 도시를 공성한다!라는 전략을 전달한다려 한다면, 첫번째 장군이 두번째 장군에게, 그 명령을 들은 두번째 장군이 세번째 장군에게 같은 내용을 담은 전령을 보낸다.

그러나 네번째 장군이 배신자인 상황을 가정했을 때, 네 번째 장군은 공성을 약화시키기 위해 다섯번째 장군에게 토요일 오후 1시에 적을 공격한다! 라는 전갈을 보낸다. 충성스러운 다섯번째 장군은 이를 그대로 여섯번째 장군에게 보내고, 금요일 오후 1시에는 전체 병력의 절반밖에 나오지 않은 비잔티움 제국의 군대는 도시 방어군에게 참패하게 된다.

이러한 참사를 해결하기 위해 장군들은 배신자를 찾아내거나, 배신자라면 알 수 없는 암호를 통해 전령을 보내거나, 여러 장군들에게 한꺼번에 전령을 보내 명령을 대조해보는 등 여러 방법을 사용해야만 한다.

## FTP Impossibility
비잔틴 제국의 문제를 풀기 위해서는 비동기 네트워크에서 Safety 와 Liveness 를 모두 만족시켜야 한다. 

1. Safety 는 "문제 없는 노드 사이에서는 그 합의 과정이 어찌되었든 결과적으로 절대 잘못된 합의가 이루어지지 않는다" 를 보장한다.

2. Liveness 는 "문제없는 노드 사이에서는 반드시 언젠가는 합의가 일어나야 한다" 를 보장한다. 

​수많은 수학자들이 이 문제를 풀기 위해 머리를 싸맸지만, 결국 한 명의 배신자만 있다고 해도, Safety 와 Liveness 를 모두 지키는 것은 불가능하기 때문에, 비잔틴 제국의 문제를 푸는 것은 불가능하다는 것이 수학적으로 밝혀졌다. 이를 FTP Impossibility 라고 부른다. ( Impossibility of Distributed Consensus with One Faulty Process, 1985 )

# 비트코인
"비잔틴 장군의 문제"가 제기된 지 50년이라는 세월이 지났고, 그동안 수많은 이론과 솔루션이 제시되었지만, 이는 대부분 중앙 집중식 제어에 의존했기 때문에 근본적으로는 해결될 수 없는 문제였다.

대부분의 공학자와 수학자는 Safety 를 최우선 순위로 두고, 그 범주 안에서 최대한 Liveness 를 보장하려는 전략을 펼쳤다. 왜냐하면 Safety 는 합의 속도 따위와는 비교가 안되는 너무나도 중요한 개념이라고 생각했기 때문이다.

하지만 비트코인은 100% 의 일관성을 포기한다는, 간단하지만 혁신적인 방법을 통해 비잔틴 장군의 문제를 해결하였다. 이는 지금까지는 존재하지 않았던 새로운 종류의 네트워크와 디지털 시스템을 만들 수 있다는 점을 의미한다.

비트코인은 탈중앙화된 네트워크에서 리더 없이 악의적인 공격을 견뎌내고 모든 참가자가 합의할 수 있다는 것을 입증한 첫번째 기술이다. 다르게 말하면, 비트코인은 "비잔틴 장군의 문제" 를 해결한 첫 번째 기술이다.

모든 장군에게 '장군은 메시지를 보내기 위해 10분의 시간을 가지며, 메시지는 모든 장군의 메시지와 메시지를 보내기 위해 10분을 들였다는 증거를 포함한다.'라는 규칙이 추가됨에 따라 중간의 비잔틴 장군이 존재하더라도 다른 장군들은 이 장군이 거짓임을 밝혀낼 수 있다. 혹은 초기에 메시지를 받은 장군이 존재하더라도 정직한 장군의 비율이 과반수이기만 하면, 시간이 흐를 수록 배신자 장군은 장군 무리 고립되고, 앞선 시나리오처럼 정직한 장군들이 성을 함락할 수 있게 된다. 

비트코인을 설계할 당시 사토시 나카모토는 참여자 모두가 가장 최신의 원장을 같이 보유할 수 있다는 점을 수학적으로 보장할 수 있도록 했다. 우선 비트코인은 참여자가 돈을 받는 순간부터 보내는 순간까지 지켜야 할 기본적인 규정을 특정한 숫자로 표현되도록 설계해놓고 있다. 사토시는 새로운 블록을 만들 때 이런 여러 숫자를 모아 이를 기초로 새로 만들 블록의 고유번호를 찾는 일종의 퍼즐 게임을 풀도록 했는데 퍼즐을 푸는 과정이 곧 작업증명이며 수학 퍼즐이 풀리면 블록이 만들어지며 이를 채굴이라고 한다. 작업증명을 수행해 퍼즐이 풀렸다면 결국 블록은 부정이 없도록 각종 규정을 지킨 정상 거래를 모아 정상적인 방법으로 만든 원장이라는 의미이다. 마지막에 나온 블록의 고윳값이 정상이면 계산과정에 들어간 모든 숫자 역시 올바른 값이므로 수학적으로도 이 값을 수용해도 좋다는 의미이다. 비트코인은 결국 작업증명을 거친 블록을 받아들이는 방식의 합의 구조를 갖추고 있다. 작업증명을 거친 블록을 실시간 공유함으로써 참여자들은 다른 장군들이 부정을 저질렀는지 걱정할 필요 없이 결국 모두가 항상 같은 원장 상태에 도달해 있게 되는 셈이다. 은행과 중앙기관의 역할은 이러한 비트코인 시스템 내에서 사라졌으며 비잔틴 장애 허용을 달성하는 가장 혁신적인 접근으로 여겨지고 있다.